# Ollama Reasoning
## Расширение Способностей к Рассуждению Любой LLM

### Цель Проекта:

**Превратить "не-рассуждающие" (non-reasoning) языковые модели, такие как `gemma3:4b` (и другие компактные LLM), в системы, способные к глубокому, многошаговому логическому рассуждению, самокоррекции и планированию, достигающие или превосходящие уровень специализированных "reasoning" моделей.**

Проект стремится дать базовым LLM, которые сами по себе могут застревать в логических петлях, делать неверные выводы или не способны к комплексному планированию, архитектуру, позволяющую им решать сложные задачи, требующие последовательного мышления и отслеживания состояний.

### Проблема, которую проект решает:

Несмотря на впечатляющие способности к генерации текста, многие компактные языковые модели (LLM), обученные на больших массивах данных, зачастую испытывают трудности с:
*   **Многошаговым планированием:** Неспособность выстроить и выполнить сложную последовательность действий для достижения цели (например, задачи с переливанием, где `gemma3:4b` зацикливается).
*   **Отслеживанием состояний:** Потеря контекста или текущего состояния в процессе выполнения сложной задачи.
*   **Последовательным логическим выводом:** Неспособность корректно интегрировать несколько условий и сделать точный вывод (как в пространственных головоломках).
*   **Самокоррекцией:** Неспособность обнаружить свои ошибки или неэффективные пути рассуждения и скорректировать их.
*   **Избеганием "галлюцинаций рассуждения":** Генерация логически несогласованных или невозможных шагов.

### Архитектура

В проекте используется подход **многоэтапной архитектуры рассуждений, в которой сочетаются планирование и доработка через самоанализ.** Она построена на **двух парах конкурирующих агентов, взаимодействующих на уровне задачи и над ней (мета-уровень)**.

В основе этой архитектуры лежат взаимодействия нескольких специализированных "интеллектуальных агентов", каждый из которых выполняет свою роль. Все эти агенты используют одну и ту же базовую LLM (например, `gemma3:4b`) для выполнения своих функций.

Эти агенты организованы в две основные **состязательные пары**, работающие на разных уровнях абстракции:

1.  **Состязательная пара "Планировщик-Рассуждающий" (Planner-Reasoner - P-R):**
    Это **композитная пара агентов**, отвечающая за **стратегическое мышление, декомпозицию задачи, генерацию планов и рефлексию на мета-уровне.**
    *   **Планировщик (Planner):** **Задача:** Генерировать пошаговые планы для решения общей задачи. Он декомпозирует проблему на управляемые подзадачи и предлагает последовательность действий.
    *   **Рассуждающий/Рефлектор (Reasoner/Reflector)::** **Задача:** Выступать в роли *критика* Планировщика. Он активно анализирует предложенный план на предмет общей логической согласованности, полноты, потенциальных тупиков, зацикливаний и оптимальности *до его выполнения*. Также он получает обратную связь (вызовы) от Состязательной пары "Рабочий-Наблюдатель" и, основываясь на ней, анализирует неудачу, предлагает модификации стратегии и инициирует генерацию нового или скорректированного плана у Планировщика.
    *   **Внутренняя Конкуренция P-R:** Планировщик предлагает стратегию/план. Рассуждающий/Рефлектор *конкурирует* с ним, пытаясь найти изъяны и заставить Планировщика улучшить или переделать план, пока не будет достигнута внутренняя "оптимальность" или "уверенность" в плане.

2.  **Состязательная пара "Рабочий-Наблюдатель" (Worker-Supervisor - W-S):**
    Это **композитная пара агентов**, отвечающая за **выполнение конкретных шагов плана и их немедленную, критическую проверку.**
    *   **Рабочий (Worker):** **Задача:** Получить один конкретный шаг плана от Состязательной пары "Планировщик-Рассуждающий" и попытаться его выполнить, используя базовую LLM для генерации требуемого вывода или действия.
    *   **Наблюдатель (Supervisor):** **Задача:** Выступать в роли *критика* Рабочего. Он немедленно и активно проверяет результат выполнения текущего шага на предмет его корректности, логической согласованности с текущим состоянием задачи и соответствия цели шага. Он также выявляет признаки зацикливания или невозможности продвижения.
    *   **Внутренняя Конкуренция W-S:** Рабочий пытается выполнить шаг и предоставить результат. Наблюдатель *конкурирует* с ним, стремясь выявить любые ошибки, неточности или логические несоответствия в его выполнении, прежде чем результат будет считаться окончательным.

Основная конкуренция в системе происходит между этими двумя композитными агентами: Состязательная пара "Планировщик-Рассуждающий" предлагает план, а Состязательная пара "Рабочий-Наблюдатель" пытается его выполнить и активно ищет ошибки и несоответствия на каждом шаге. Если "Рабочий-Наблюдатель" обнаруживает проблему, он "бросает вызов" "Планировщику-Рассуждающему", инициируя пересмотр стратегии и генерацию нового плана. Этот замкнутый цикл обратной связи обеспечивает постоянное стремление к оптимальному и корректному решению.

### Что проект достигает:

Благодаря этой архитектуре, `ollama-reasoning` позволяет базовым LLM:
*   **Разбивать сложные задачи:** Эффективно декомпозировать задачи на управляемые этапы.
*   **Следовать логике и отслеживать состояния:** Поддерживать последовательное понимание контекста и текущего положения в задаче.
*   **Избегать зацикливания:** Автоматически распознавать и выходить из повторяющихся, непродуктивных циклов рассуждений.
*   **Самокорректироваться:** Учиться на ошибках и адаптировать свою стратегию для успешного решения.
*   **Достигать результатов, сравнимых или превосходящих специализированные Reasoning LLM**, при использовании менее мощных или более компактных базовых моделей.

## Гибкость архитектуры: Выбор режима рассуждения

Проект `Ollama Reasoning` разработан с учетом гибкости, позволяя пользователям выбирать между двумя уровнями сложности и производительности: **базовой (стандартный режим)** и **полной (полный режим рассуждения)** архитектурой. Это дает возможность оптимизировать использование ресурсов в зависимости от сложности решаемой задачи и требуемого уровня надежности.

### 1. Стандартный режим (Standard Mode): `Планировщик` + `Рабочий`

Этот режим активирует базовую связку агентов, которая уже значительно повышает способности LLM к структурированному рассуждению и прозрачности.

*   **Как это работает:**
    *   **Планировщик:** Получает задачу и генерирует пошаговый `План рассуждений` (Deliberation Plan).
    *   **Рабочий:** Получает этот план и приступает к его выполнению. Он ведет подробный внутренний монолог, шаг за шагом следуя плану, и формирует окончательный ответ.
*   **Преимущества:**
    *   **Эффективность:** Значительно быстрее и экономичнее по сравнению с полной архитектурой, так как требует меньше итераций и вызовов LLM.
    *   **Прозрачность:** Предоставляет детальный блок `/think`, позволяющий отслеживать мыслительный процесс модели.
    *   **Достаточность для многих задач:** Отлично справляется с большинством стандартных запросов, включая объяснения, рекомендации, простые вычисления и многошаговые логические задачи с предсказуемым решением.
    *   **Надежное форматирование:** Обеспечивает чистый, структурированный вывод.
*   **Идеально подходит для:**
    *   Общих вопросов и ответов.
    *   Задач, где решение имеет относительно линейный характер.
    *   Приложений, требующих быстрого ответа и экономии ресурсов.

### 2. Полный режим рассуждения (Full Reasoning Mode): `Планировщик-Рассуждающий` + `Рабочий-Наблюдатель`

Этот режим активирует все четыре специализированных агента и их конкурентные взаимодействия, предназначенные для решения наиболее сложных и критических задач, где требуется высокий уровень самокоррекции и устойчивости к ошибкам.

*   **Как это работает:**
    1.  **Планировщик** генерирует начальный план.
    2.  **Рассуждающий/Рефлектор** (критик Планировщика) активно анализирует предложенный план на логическую непротиворечивость, полноту, потенциальные тупики, зацикливания и оптимальность *до его выполнения*. Если план признан неоптимальным или содержащим ошибки, Рассуждающий/Рефлектор заставляет Планировщика пересмотреть его.
    3.  **Рабочий** исполняет *каждый шаг* утвержденного плана.
    4.  **Наблюдатель** (критик Рабочего) немедленно и активно проверяет результат выполнения текущего шага на корректность, логическую согласованность с текущим состоянием задачи и соответствие цели шага.
    5.  Если Наблюдатель обнаруживает ошибку, зацикливание или невозможность продвинуться, он "бросает вызов" Рассуждающему/Рефлектору, инициируя пересмотр стратегии и генерацию нового плана.
    6.  Этот замкнутый цикл обратной связи продолжается до тех пор, пока не будет достигнуто оптимальное и корректное решение.
*   **Преимущества:**
    *   **Максимальная надежность:** Значительно повышает точность и корректность решений для сложных задач, минимизируя логические ошибки и "галлюцинации".
    *   **Активная самокоррекция:** Система способна обнаруживать и исправлять свои собственные ошибки на разных уровнях, а не только на уровне конечного результата.
    *   **Способность решать трудные задачи:** Эффективно преодолевает проблемы, связанные с многошаговым планированием, отслеживанием состояния, тупиками и циклами (например, классическая "задача с ведрами").
    *   **Устойчивость к "не-рассуждающим" LLM:** Позволяет менее мощным или компактным базовым LLM достигать уровня специализированных "рассуждающих" моделей.
*   **Недостатки:**
    *   **Высокая вычислительная стоимость:** Значительно больше вызовов LLM и, как следствие, выше затраты на токены и время выполнения.
    *   **Увеличенное время ответа:** Из-за многочисленных итераций проверки и рефлексии.
*   **Идеально подходит для:**
    *   Сложных, многошаговых логических задач и головоломок.
    *   Задач, требующих точного отслеживания состояний.
    *   Приложений, где критически важна абсолютная точность решения, и допустимость ошибок крайне низка.
    *   Использования с менее мощными или компактными базовыми LLM, которые без такой структуры часто ошибаются.